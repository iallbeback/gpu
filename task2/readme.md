# ADI3D Benchmark: CPU vs GPU (Alternating Direction Implicit Method)

Этот проект реализует трёхмерный численный метод переменных направлений (ADI) с поддержкой запуска:
- на CPU (с использованием OpenMP),
- на GPU (с использованием CUDA).

Программа включает утилиту сравнения для анализа точности расчётов и производительности разных реализаций.

## Особенности реализации

1. **Метод ADI**:
   - Разбиение трёхмерной задачи на последовательность одномерных решений по разным направлениям (X, Y, Z)
   - Переупорядочивание данных для эффективного доступа к памяти при обработке Z-направления

2. **Оптимизации**:
   - Поддержка как float, так и double precision
   - Гибкая настройка размеров CUDA-блоков
   - Эффективное вычисление максимальной ошибки (EPS) на GPU

## Структура проекта

- **`adi3d_cpu.c`** — реализация на CPU с использованием OpenMP
- **`adi3d_gpu.cu`** — реализация на CUDA с оптимизированными ядрами
- **`compare_results.c`** — программа для сравнения результатов и производительности
- **`Makefile`** — сборка всех компонентов и управление тестами
- **`cpu_output.txt`, `gpu_output.txt`** — результаты расчётов для анализа
- **Поддержка float/double** через флаг компиляции `USE_REAL_DOUBLE`

## Сборка и запуск

### Сборка проекта
```bash
make
```

### Запуск отдельных версий
CPU-версия:
```bash
./adi3d_cpu
```

GPU-версия:
```bash
./adi3d_gpu
```

### Сравнение результатов
```bash
make run
```

### Тестирование различных размеров блоков
```bash
make test_blocks
```

### Профилирование различных размеров блоков
```bash
make prof
```

Тестируются следующие конфигурации блоков:
- 4x4
- 8x8
- 16x16
- 16x8
- 8x16
- 32x32
- 32x8
- 8x32

## Пример результатов

При использовании CUDA-блоков размера 16×16:

```bash
--- Comparison Report ---
CPU eps: 0.90896725
GPU eps: 0.90896725
CPU time: 4.94 sec
GPU time: 3.67 sec
Speedup (CPU/GPU): 1.35x
✅ EPS values match (within threshold).
```

## Технические детали

### Параметры задачи
- Размер сетки по умолчанию: 900×900×900
- Максимальное число итераций: 10
- Порог сходимости (MAXEPS): 0.01

### Особенности GPU-реализации
- Использование атомарных операций для вычисления максимальной ошибки
- Оптимизированное переупорядочивание данных для Z-направления
- Разделяемая память для редукции ошибок внутри блоков

### Производительность
Как видно из результатов, GPU-версия демонстрирует ускорение ~1.35x по сравнению с CPU-версией для данной задачи. Оптимальные размеры блоков могут варьироваться в зависимости от конкретного GPU.

## Анализ размеров блоков

Проект включает возможность автоматического тестирования различных размеров CUDA-блоков для определения оптимальной конфигурации. Результаты могут быть визуализированы с использованием Jupyter Notebook (аналогично первому заданию).

Для запуска серии тестов:
```bash
make test_blocks
```

Результаты сохраняются в директории `test_blocks/` для последующего анализа.

![График результатов](https://github.com/user-attachments/assets/5e1c91de-7c66-463e-8b42-27e0bb0c3ba2)
